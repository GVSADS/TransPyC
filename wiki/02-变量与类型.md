# 变量与类型

## 变量声明

### 基本语法

```python
import t

def main() -> t.CInt:
    # 基本类型变量
    a: t.CInt = 10
    b: t.CChar = 'A'
    c: t.CFloat = 3.14
    
    return 0
```

编译后：

```c
int main(void) {
    int a = 10;
    char b = 'A';
    float c = 3.14;
    
    return 0;
}
```

### 仅声明不初始化

```python
import t, c

def main() -> t.CInt:
    # 仅声明，不初始化
    x: t.CInt = c.State  # 对应 C: int x;
    
    return 0
```

编译后：

```c
int main(void) {
    int x;
    
    return 0;
}
```

## 基本类型

### 整数类型

```python
import t

def main() -> t.CInt:
    a: t.CChar = 127           # 8位有符号整数
    b: t.CShort = 32767        # 16位有符号整数
    c: t.CInt = 2147483647     # 32位有符号整数
    d: t.CLong = 2147483647    # 32/64位有符号整数
    e: t.CLongLong = 9223372036854775807  # 64位有符号整数
    
    # 无符号类型
    ua: t.CUnsignedChar = 255
    ub: t.CUnsignedShort = 65535
    uc: t.CUnsignedInt = 4294967295
    ud: t.CUnsignedLong = 4294967295
    
    return 0
```

编译后：

```c
int main(void) {
    char a = 127;
    short b = 32767;
    int c = 2147483647;
    long d = 2147483647;
    long long e = 9223372036854775807;
    
    unsigned char ua = 255;
    unsigned short ub = 65535;
    unsigned int uc = 4294967295;
    unsigned long ud = 4294967295;
    
    return 0;
}
```

### 浮点类型

```python
import t

def main() -> t.CInt:
    f: t.CFloat = 3.14159      # 32位浮点
    d: t.CDouble = 3.14159265358979  # 64位浮点
    
    return 0
```

编译后：

```c
int main(void) {
    float f = 3.14159;
    double d = 3.14159265358979;
    
    return 0;
}
```

## 指针类型

### 指针声明

```python
import t

def main() -> t.CInt:
    # 指针声明
    ptr: t.CInt | t.CPtr       # int* ptr
    
    return 0
```

编译后：

```c
int main(void) {
    int* ptr;
    
    return 0;
}
```

### 指针运算

```python
import t

def main() -> t.CInt:
    arr: t.CInt[10]
    ptr: t.CInt | t.CPtr = arr
    
    # 指针解引用
    ptr[0] = 10
    ptr[1] = 20
    
    # 指针算术
    ptr = ptr + 1
    
    return 0
```

编译后：

```c
int main(void) {
    int arr[10];
    int* ptr = arr;
    
    ptr[0] = 10;
    ptr[1] = 20;
    
    ptr = (ptr + 1);
    
    return 0;
}
```

### 多级指针

```python
import t

def main() -> t.CInt:
    # 二级指针
    pp: t.CPtr | t.CInt | t.CPtr  # int** pp
    
    return 0
```

编译后：

```c
int main(void) {
    int** pp;
    
    return 0;
}
```

## 数组类型

### 一维数组

```python
import t

def main() -> t.CInt:
    # 数组声明
    arr: t.CInt[10]            # int arr[10]
    
    # 数组初始化
    arr2: t.CInt[5] = [1, 2, 3, 4, 5]  # int arr2[5] = {1, 2, 3, 4, 5}
    
    # 数组访问
    arr[0] = 10
    x: t.CInt = arr[0]
    
    return 0
```

编译后：

```c
int main(void) {
    int arr[10];
    int arr2[5] = { 1, 2, 3, 4, 5 };
    
    arr[0] = 10;
    int x = arr[0];
    
    return 0;
}
```

### 多维数组

```python
import t

def main() -> t.CInt:
    # 二维数组
    matrix: t.CInt[3][3]       # int matrix[3][3]
    
    # 访问
    matrix[0][0] = 1
    matrix[1][2] = 5
    
    return 0
```

编译后：

```c
int main(void) {
    int matrix[3][3];
    
    matrix[0][0] = 1;
    matrix[1][2] = 5;
    
    return 0;
}
```

### 指针数组

```python
import t

def main() -> t.CInt:
    # 指针数组
    ptr_arr: t.CPtr | t.CInt[10]  # int* ptr_arr[10]
    
    return 0
```

编译后：

```c
int main(void) {
    int* ptr_arr[10];
    
    return 0;
}
```

## 类型修饰符

### const 修饰符

```python
import t

def main() -> t.CInt:
    # const 变量
    x: t.CConst | t.CInt = 10  # const int x = 10
    
    # const 指针
    ptr: t.CConst | t.CInt | t.CPtr  # const int* ptr
    
    return 0
```

编译后：

```c
int main(void) {
    const int x = 10;
    const int* ptr;
    
    return 0;
}
```

### static 修饰符

```python
import t

def get_counter() -> t.CInt:
    # static 变量
    count: t.CStatic | t.CInt = 0  # static int count = 0
    count = count + 1
    return count
```

编译后：

```c
int get_counter(void) {
    static int count = 0;
    count = (count + 1);
    return count;
}
```

### volatile 修饰符

```python
import t

def main() -> t.CInt:
    # volatile 变量
    flag: t.CVolatile | t.CInt = 0  # volatile int flag = 0
    
    return 0
```

编译后：

```c
int main(void) {
    volatile int flag = 0;
    
    return 0;
}
```

## 类型转换

### 显式类型转换

```python
import t

def main() -> t.CInt:
    a: t.CInt = 10
    b: t.CFloat = t.CFloat(a)  # (float)a
    
    return 0
```

编译后：

```c
int main(void) {
    int a = 10;
    float b = (float)a;
    
    return 0;
}
```

### 指针类型转换

```python
import t

def main() -> t.CInt:
    ptr: t.CVoid | t.CPtr
    iptr: t.CInt | t.CPtr = t.CInt | t.CPtr(ptr)  # (int*)ptr
    
    return 0
```

编译后：

```c
int main(void) {
    void* ptr;
    int* iptr = (int*)ptr;
    
    return 0;
}
```

## 类型大小

### sizeof 操作

```python
import t, c

def main() -> t.CInt:
    # 获取类型大小
    size_int: t.CInt = t.sizeof(t.CInt)      # sizeof(int)
    size_char: t.CInt = t.sizeof(t.CChar)    # sizeof(char)
    
    # 获取变量大小
    arr: t.CInt[10]
    size_arr: t.CInt = t.sizeof(arr)         # sizeof(arr)
    
    return 0
```

编译后：

```c
int main(void) {
    int size_int = sizeof(int);
    int size_char = sizeof(char);
    
    int arr[10];
    int size_arr = sizeof(arr);
    
    return 0;
}
```
